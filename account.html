<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <style>
      body {
        background-color: #EEF0F2;
      }
  
      .navBars {
        background-color: #EEC643;
      }
    </style>
    <title>Store Search Locator</title>
  </head>
  <body>

    <!--Nav bar-->
    <nav class="navbar navbar-expand-lg navbar-light navBars">
      <div class="container-fluid">
        <a class="navbar-brand">Find Local</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a id="profileGo" class="nav-link active" aria-current="page" href="#">Profile</a>
            </li>
            <li class="nav-item">
              <a id="helpGo" class="nav-link" href="#">Help</a>
            </li>
            </ul>
          <div class="d-flex">

            <a href="login.html" class="btn btn-dark">Logout</a>
  
            <input id="storeSearch" Class="form-control me-2" placeholder="Search stores">
            <button id="searchSubmit" class="btn btn-outline-success">Search</button>
          </div>
        </div>
      </div>
    </nav>
    <div class="container">
      <h1 class="display-4">Hello, <span id = "welcome"></span></h1>
    </div>

    <!--responsive grid-->
    <div class="container" style="padding: 3em; margin: 0 auto; width:85%; background-color: #dedede;" >
      <div class="row">
        <div class="col-md-3">

          <img id="profilePic" src="https://dummyimage.com/200x200/000/fff" class="img-thumbnail" alt="Profile Picture">


          <form action="upload.php" method="post" enctype="multipart/form-data">
            Select image to upload:
            <input type="file" name="fileToUpload" id="fileToUpload">
            <input type="submit" value="Upload Image" name="submit">
          </form>

        </div>
        <div class="col-lg-4" style="margin-Bottom:1em;">

                    <!--profile with desabled forms-->
                    <form>
                      <fieldset>
                        <div class="mb-3">

                          <!--original label was disabledTextInput for input but will need to change-->

                          <label for="TextInput" class="form-label">Username </label>
                          <input type="text" id="userNameHolder" class="form-control myText" placeholder="NA">
                        </div>
          
                        <div class="mb-3">
                          <label for="TextInput" class="form-label">Address</label>
                          <input type="text" id="userAddressHolder" class="form-control" placeholder="NA">
                        </div>
          
                        <div class="mb-3">
                          <label for="TextInput" class="form-label">Tell us about yourself</label>
                          <input type="text" id="userInfoHolder" class="form-control" placeholder="NA">
                        </div>              
                      </fieldset>
                    </form>
          
                    <div class="d-grid gap-2">
                      <button id="saveButton" class="btn btn-primary btn-dark" type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop">save</button>
                    </div>

        </div>
        <div class="col-lg-4">

          <!--links for favorite pages-->
          <div class="list-group" id="favorites" >
            <a href="#" class="list-group-item list-group-item-action active bg-dark" aria-current="true">
              Favorites
            </a>
          </div>

        </div>

        
      </div>


<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Updated</h5>
        <button type="button" class="btn-close btn-dark" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Your personal information has been updated!
      </div>
      <div class="modal-footer">
        <button id="understood" type="button" class="btn btn-primary btn-dark">Understood</button>
      </div>
    </div>
  </div>
</div>



    </div> 






    


    


  <!--footer-->
  <!--footer-->
  <nav class="navbar fixed-bottom navbar-light navBars">
    <div class="container-fluid">
      <button id="homeGO" class="btn btn-primary btn-dark" type="button">Home</button>
      <button id="favoritesGo" class="btn btn-primary btn-dark" type="reset" value="Favorites">Favorites</button>
    </div>
  </nav>

    




    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.6.0/dist/umd/popper.min.js" integrity="sha384-KsvD1yqQ1/1+IA7gi3P0tyJcT3vR+NdBTt13hSJ2lnve8agRGXTTyNaBYmCR/Nwi" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.min.js" integrity="sha384-nsg8ua9HAw1y0W1btsyWgBklPnCUAFLuTMS2G72MMONqmOymq585AcH49TLBQObG" crossorigin="anonymous"></script>
    -->

    <!--firebase js-->
    
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js"></script>

    <script src="scripts/firebase-api-storesearch.js"></script>
    <script src="scripts/FunctionsPrabh.js"></script>

<!--function for retrieving from the database-->
    <script>
      function displayUsers(){

        const parsedUrl = new URL(window.location.href);
        var userID = parsedUrl.searchParams.get("id");
        console.log("Retrieved ID " + userID);
        
        //modified so will take id from url 
    db.collection("users").doc(userID).get()
    .then(function(doc){
            var userAddress = doc.data().address;     
            console.log(userAddress);
            var userName = doc.data().name; 
            console.log(userName);
            var userInfo = doc.data().personalDescription;
            console.log(userInfo);
 
           document.getElementById("welcome").innerText = userName;
           document.getElementById("userNameHolder").placeholder = userName;
           document.getElementById("userAddressHolder").placeholder = userAddress;
           document.getElementById("userInfoHolder").placeholder = userInfo;
    

          

            // how to access the array holding favorite stores. 

            var test = doc.data().favStores;
            console.log(test);

            //if time add something sayng you have no favorites go look around.
            if(test.length == 0) {

              var noFavorites = document.createElement("a");
           // storeLink.id = "forMore";
           noFavorites.textContent = "Go search and find some favorites!";
            noFavorites.className = "list-group-item list-group-item-action";
              document.getElementById("favorites").appendChild(noFavorites);

            } else if(test.length <= 5) {

              for (i = 0; i < test.length; i++) {


db.collection("storesDatabase").doc(test[i])
.get()
.then(function (doc){



  console.log("this is a test "  + doc.data().storeInformation.name);
  console.log("testing the idnex " + i);
  var storeLink = document.createElement("a");
storeLink.textContent = doc.data().storeInformation.name;
storeLink.className = "list-group-item list-group-item-action";
storeLink.href = "storeInformation.html?search=local&storeID=" + doc.id + "&id=" +userID; //shold be test[i] but sees it as undefined.

document.getElementById("favorites").appendChild(storeLink);



});


}

            }

            else {

              for (i = 0; i < 5; i++) {


db.collection("storesDatabase").doc(test[i])
.get()
.then(function (doc){



  console.log("this is a test "  + doc.data().storeInformation.name);
  console.log("testing the idnex " + i);
  var storeLink = document.createElement("a");
storeLink.textContent = doc.data().storeInformation.name;
storeLink.className = "list-group-item list-group-item-action";
storeLink.href = "storeInformation.html?search=local&storeID=" + doc.id + "&id=" +userID; //shold be test[i] but sees it as undefined.

document.getElementById("favorites").appendChild(storeLink);



});


}

            }

            
            

          // a 'more' link will appear for rest of list. 

          if(test.length > 5) {


// adding a more page for full
var storeLink = document.createElement("a");
storeLink.id = "forMore";
storeLink.textContent = "Click here for more!";
storeLink.className = "list-group-item list-group-item-action";
document.getElementById("favorites").appendChild(storeLink);


// modifying "more" click to pull up personal favorite page.
document.getElementById("forMore")
.addEventListener("click", function() {
   window.location.href="favorites.html?id=" + userID;
});


//  break;
}
           


              

           // when you are udpating information
           document.getElementById("saveButton")
                .addEventListener("click", function() {


                  tempName = document.getElementById("userNameHolder").value;
                  tempAddress = document.getElementById("userAddressHolder").value;
                  tempInfo = document.getElementById("userInfoHolder").value;

                  if (tempName != "") {

                    db.collection("users").doc(userID)
                    .update({
                    name: tempName
                  });

                  }

                  if (tempAddress != "") {

                  db.collection("users").doc(userID)
                  .update({
                  address: tempAddress
                  });

                  } 

                  if (tempInfo != "") {

                  db.collection("users").doc(userID)
                  .update({
                  personalDescription: tempInfo
                  });

                  } 


                  



                  


                });



                
        

    })





}
displayUsers();
    </script>
    <script>

                document.getElementById("understood")
                .addEventListener("click", function() {
                  window.location.reload();
                });

    </script>



           
<script src="scripts/searchFunctions.js"></script>
  <script>getSearchBar();</script>


    


  </body>
</html>